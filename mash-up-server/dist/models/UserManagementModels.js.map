{"version":3,"sources":["../../src/models/UserManagementModels.js"],"names":["validator","require","bcrypt","randomstring","jwt","userSchema","mongoose","Schema","_id","type","String","required","email","unique","trim","validate","isEmail","message","password","minLength","role","organizationCode","tokens","access","token","methods","generateAuthToken","user","isNew","generate","length","charset","sign","JWTSecret","toString","push","save","then","removeToken","filter","el","result","statics","findUserByEmail","User","findOne","comparePassword","clientPassword","hashedPassword","compare","findUserByToken","model","module","exports"],"mappings":"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","file":"UserManagementModels.js","sourcesContent":["import mongoose from 'mongoose';\nimport {mongooseConnection} from '../globals/MongoDbConfig';\nconst validator = require('validator');\nconst bcrypt = require('bcryptjs');\nconst randomstring = require(\"randomstring\");\nconst jwt = require('jsonwebtoken');\nimport {JWTSecret} from '../globals/DbConfig';\n\nvar userSchema = new mongoose.Schema({\n    _id:{\n        type:String,\n        required:true\n    },\n    email:{\n        type:String,\n        unique:true,\n        required:true,\n        trim:true,\n        validate: {\n            validator:validator.isEmail,\n            message:\"Not a valid email\"\n        }\n    },\n    password:{\n        type:String,\n        required:true,\n        trim:true,\n        minLength:6\n    },\n    role:{\n        type:String,\n        required:false\n    },\n    organizationCode:{\n        required:true,\n        type:String\n    },\n    tokens:[{\n        access:{\n            type:String,\n            required:true\n        },\n        token:{\n            type:String,\n            required:true\n        }\n    }]\n});\nuserSchema.methods.generateAuthToken = function(){\n    var user = this;\n    user.isNew = false;\n    var access = randomstring.generate({\n        length: 12,\n        charset: 'alphanumeric'\n    });\n    var token = jwt.sign({\"user\":user.email,\"role\":user.role,\"organizationCode\":user.organizationCode, access},JWTSecret).toString();\n    user.tokens.push({access,token});\n    return user.save().then(()=>{\n        return token;\n    });\n}\nuserSchema.methods.removeToken = function(token){\n    var user =  this;\n    user.tokens = user.tokens.filter((el)=>{\n        return el.token != token\n    });\n    return user.save().then((result)=>{\n        return result;\n    })\n}\nuserSchema.statics.findUserByEmail = function(email){\n    var User = this;\n    return User.findOne({\"email\":email})\n}\nuserSchema.statics.comparePassword = function(clientPassword, hashedPassword){\n    return bcrypt.compare(clientPassword, hashedPassword);\n}\n\nuserSchema.statics.findUserByToken = function(token){\n    var User = this;\n    return User.findOne({\"tokens.token\":token});\n}\nvar User = mongoose.model('User', userSchema,'userLogin');\n\n\n\nmodule.exports = {User};\n"]}