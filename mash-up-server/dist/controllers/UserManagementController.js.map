{"version":3,"sources":["../../src/controllers/UserManagementController.js"],"names":["initialLoginValidation","signUserJwtToken","verifyAndRemoveUser","req","res","next","body","email","password","length","status","send","User","findUserByEmail","then","user","comparePassword","_id","role","organizationCode","error","generateAuthToken","token","cookies","catch","err","console","log","findUserByToken","loggedInUser","decodedToken","removeToken"],"mappings":"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","file":"UserManagementController.js","sourcesContent":["import {User} from '../models/UserManagementModels'\nimport { verifyJwtToken } from '../controllers/globalController/VerifyJWTToken'\n\n\nexport function initialLoginValidation(req, res, next){\n    if(req.body.email == \"\" || req.body.password.length>16 || req.body.password.length<8){\n        res.status(401).send(\"Not allowed\")\n    } else {\n          User.findUserByEmail(req.body.email).then((user)=>{\n          if(!user){\n               res.status(401).send({\"error\":true})\n           } else {\n              User.comparePassword(req.body.password, user.password).then((res)=>{\n                  if(!res){\n                      res.send({\"error\":true})\n                  } else {\n                      req.user = {\"error\":false,\"_id\":user._id,\"email\":user.email,\"password\":user.password,\"role\":user.role,\"organizationCode\" : user.organizationCode};\n                      next();\n                  }\n              }); \n           }\n      });\n    }\n}\nexport function signUserJwtToken (req, res, next){\n    if(!req.user.error){\n        var user = new User({\"_id\":req.user._id,\"email\":req.user.email,\"password\":req.user.password,\"role\":req.user.role,\"organizationCode\":req.user.organizationCode});\n        user.generateAuthToken().then((token)=>{\n            req.cookies.token = token\n            req.token = token\n            next();\n        }).catch((err)=>{\n            console.log(err);\n            res.status(403).send({\"error\":\"Error while performing action\"})\n        });\n    }else{\n        res.status(400).send({\"error\":\"something went wrong\"});\n    }\n}\nexport function verifyAndRemoveUser(req, res, next){\n    if(req.body.token){\n        User.findUserByToken(req.body.token).then((user)=>{\n            if(user!==null && user.email === req.body.email){\n                var loggedInUser = new User(user);\n                verifyJwtToken(req.body.token).then((decodedToken)=>{\n                    if(decodedToken && decodedToken.user === req.body.email){\n                        loggedInUser.removeToken(req.body.token).then((user)=>{\n                           next();\n                        }).catch((err)=>{\n                            res.status(403).send({\"error\":\"Action failed\"})\n                        })\n                    } else {\n                        res.status(401).send({\"error\":\"Action failed\"})\n                    }\n                })\n            } else{\n                res.status(401).send({\"error\":\"Cannot perform action\"});\n            }\n        }).catch((err)=>{\n            res.status(401).send({\"error\":\"Cannot locate user\"})\n        })\n    }\n    else {\n        res.status(401).send({\"error\":\"Can't perform action\"});\n    }\n}"]}