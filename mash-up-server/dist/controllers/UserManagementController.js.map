{"version":3,"sources":["../../src/controllers/UserManagementController.js"],"names":["initialLoginValidation","signUserJwtToken","verifyAndRemoveUser","req","res","next","body","email","password","length","status","send","findUserByEmail","then","user","comparePassword","_id","role","organizationCode","error","generateAuthToken","token","cookies","catch","err","console","log","findUserByToken","loggedInUser","decodedToken","removeToken"],"mappings":"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","file":"UserManagementController.js","sourcesContent":["import {User} from '../models/UserManagementModels'\nimport { verifyJwtToken } from '../controllers/globalController/VerifyJWTToken'\n\n\nexport function initialLoginValidation(req, res, next){\n    if(req.body.email == \"\" || req.body.password.length>16 || req.body.password.length<8){\n        res.status(401).send(\"Not allowed\")\n    } else {\n          User.findUserByEmail(req.body.email).then((user)=>{\n          if(!user){\n               res.status(401).send({\"error\":true})\n           } else {\n              User.comparePassword(req.body.password, user.password).then((res)=>{\n                  if(!res){\n                      res.send({\"error\":true})\n                  } else {\n                      req.user = {\"error\":false,\"_id\":user._id,\"email\":user.email,\"password\":user.password,\"role\":user.role,\"organizationCode\" : user.organizationCode};\n                      next();\n                  }\n              }); \n           }\n      });\n    }\n}\nexport function signUserJwtToken (req, res, next){\n    if(!req.user.error){\n        var user = new User({\"_id\":req.user._id,\"email\":req.user.email,\"password\":req.user.password,\"role\":req.user.role,\"organizationCode\":req.user.organizationCode});\n        user.generateAuthToken().then((token)=>{\n            req.cookies.token = token\n            req.token = token\n            next();\n        }).catch((err)=>{\n            console.log(err);\n            res.status(403).send({\"error\":\"Error while performing action\"})\n        });\n    }else{\n        res.status(400).send({\"error\":\"something went wrong\"});\n    }\n}\nexport function verifyAndRemoveUser(req, res, next){\n    if(req.body.token){\n        User.findUserByToken(req.body.token).then((user)=>{\n            if(user!==null && user.email === req.body.email){\n                var loggedInUser = new User(user);\n                verifyJwtToken(req.body.token).then((decodedToken)=>{\n                    if(decodedToken && decodedToken.user === req.body.email){\n                        loggedInUser.removeToken(req.body.token).then((user)=>{\n                           next();\n                        }).catch((err)=>{\n                            res.status(403).send({\"error\":\"Action failed\"})\n                        })\n                    } else {\n                        res.status(401).send({\"error\":\"Action failed\"})\n                    }\n                })\n            } else{\n                res.status(401).send({\"error\":\"Cannot perform action\"});\n            }\n        }).catch((err)=>{\n            res.status(401).send({\"error\":\"Cannot locate user\"})\n        })\n    }\n    else {\n        res.status(401).send({\"error\":\"Can't perform action\"});\n    }\n}"]}